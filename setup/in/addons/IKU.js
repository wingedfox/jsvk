VirtualKeyboard.Langs.IKU = new function () {
    var reNotIKU = /[^acefghijklłmnopqrstuvwxyᖃᐁᕋᑕᐂᐅᐃᐸᐊᓴᖕᒐᕼᔭᑲᓚᖤᕙᓇᒪ]/
       ,remap={
            'ᐊi':'ᐁ','ᐃi':'ᐄ','ᐅu':'ᐆ','ᐊa':'ᐋ'
           ,'ᐿi':'ᐯ','-i':'-','ᐳu':'+','ᐿa':'ᐳ'
           ,'ᑕi':'ᑌ','ᑎi':'ᑏ','ᑐu':'ᑑ','ᑕa':'ᑖ'
           ,'-i':'ᑫ','ᑭi':'ᑮ','ᑯu':'-','-a':'ᑳ'
           ,'ᒐi':'ᒉ','ᒋi':'ᒌ','ᒍu':'ᒎ','ᒐa':'ᒑ'
           ,'ᒪi':'ᒣ','ᒥi':'ᒦ','ᒧu':'ᒨ','ᒪa':'ᒫ'
           ,'ᓇi':'ᓀ','ᓂi':'ᓃ','ᓄu':'ᓅ','ᓇa':'ᓈ'
           ,'+i':'ᓭ','ᓯi':'-','-u':'-','+a':'ᓳ'
           ,'ᓚi':'ᓓ','ᓕi':'ᓖ','ᓗu':'ᓘ','ᓚa':'ᓛ'
           ,'ᔭi':'ᔦ','ᔨi':'ᔩ','ᔪu':'ᔫ','ᔭa':'ᔮ'
           ,'ᕙi':'ᕓ','ᕕi':'ᕖ','ᕗu':'ᕘ','ᕙa':'ᕚ'
           ,'ᕋi':'ᕃ','ᕆi':'ᕇ','ᕈu':'ᕉ','ᕋa':'ᕌ'
           ,'ᖃi':'ᙯ','ᕿi':'ᖀ','ᖁu':'ᖂ','ᖃa':'ᖄ'
           ,'ᖓi':'-','ᖏi':'ᖐ','ᖑu':'ᖒ','ᖓa':'ᖔ'
           ,'-i':'-','ᙳu':'+','ᙳa':'ᙳ'
           ,'ᖠi':'ᖡ','ᖢu':'ᖣ','ᖤa':'ᖥ'

           ,'ᐂ':'ᐂ','ᐧ':''
           ,'ᐊᐃ':'ᐁ','ᐃᐃ':'ᐄ','ᐅᐅ':'ᐆ','ᐊᐊ':'ᐋ','ᐃᐧ':'ᐄ','ᐅᐧ':'ᐆ','ᐊᐧ':'ᐋ'
           ,'ᑉᐂ':'-','ᑉᐁ':'ᐯ','ᐿᐃ':'ᐯ','-ᐃ':'-','ᐳᐅ':'+','ᐿᐊ':'ᐳ','-ᐧ':'-','ᐳᐧ':'+','ᐿᐧ':'ᐳ'
           ,'ᑦᐂ':'ᑍ','ᑦᐁ':'ᑌ','ᑕᐃ':'ᑌ','ᑎᐃ':'ᑏ','ᑐᐅ':'ᑑ','ᑕᐊ':'ᑖ','ᑎᐧ':'ᑏ','ᑐᐧ':'ᑑ','ᑕᐧ':'ᑖ'
           ,'ᒃᐂ':'ᑬ','ᒃᐁ':'ᑫ','-ᐃ':'ᑫ','ᑭᐃ':'ᑮ','ᑯᐅ':'-','-ᐊ':'ᑳ','ᑭᐧ':'ᑮ','ᑯᐧ':'-','-ᐧ':'ᑳ'
           ,'ᒡᐂ':'ᒊ','ᒡᐁ':'ᒉ','ᒐᐃ':'ᒉ','ᒋᐃ':'ᒌ','ᒍᐅ':'ᒎ','ᒐᐊ':'ᒑ','ᒋᐧ':'ᒌ','ᒍᐧ':'ᒎ','ᒐᐧ':'ᒑ'
           ,'ᒿᐂ':'ᒤ','ᒿᐁ':'ᒣ','ᒪᐃ':'ᒣ','ᒥᐃ':'ᒦ','ᒧᐅ':'ᒨ','ᒪᐊ':'ᒫ','ᒥᐧ':'ᒦ','ᒧᐧ':'ᒨ','ᒪᐧ':'ᒫ'
           ,'ᓐᐂ':'ᓁ','ᓐᐁ':'ᓀ','ᓇᐃ':'ᓀ','ᓂᐃ':'ᓃ','ᓄᐅ':'ᓅ','ᓇᐊ':'ᓈ','ᓂᐧ':'ᓃ','ᓄᐧ':'ᓅ','ᓇᐧ':'ᓈ'
           ,'ᔅᐂ':'ᓮ','ᔅᐁ':'ᓭ','+ᐃ':'ᓭ','ᓯᐃ':'-','-ᐅ':'-','+ᐊ':'ᓳ','ᓯᐧ':'-','-ᐧ':'-','+ᐧ':'ᓳ'
           ,'ᓪᐂ':'ᓔ','ᓪᐁ':'ᓓ','ᓚᐃ':'ᓓ','ᓕᐃ':'ᓖ','ᓗᐅ':'ᓘ','ᓚᐊ':'ᓛ','ᓕᐧ':'ᓖ','ᓗᐧ':'ᓘ','ᓚᐧ':'ᓛ'
           ,'-ᐂ':'ᔧ','-ᐁ':'ᔦ','ᔭᐃ':'ᔦ','ᔨᐃ':'ᔩ','ᔪᐅ':'ᔫ','ᔭᐊ':'ᔮ','ᔨᐧ':'ᔩ','ᔪᐧ':'ᔫ','ᔭᐧ':'ᔮ'
           ,'ᕝᐂ':'ᕔ','ᕝᐁ':'ᕓ','ᕙᐃ':'ᕓ','ᕕᐃ':'ᕖ','ᕗᐅ':'ᕘ','ᕙᐊ':'ᕚ','ᕕᐧ':'ᕖ','ᕗᐧ':'ᕘ','ᕙᐧ':'ᕚ'
           ,'ᕐᐂ':'ᕅ','ᕐᐁ':'ᕃ','ᕋᐃ':'ᕃ','ᕆᐃ':'ᕇ','ᕈᐅ':'ᕉ','ᕋᐊ':'ᕌ','ᕆᐧ':'ᕇ','ᕈᐧ':'ᕉ','ᕋᐧ':'ᕌ'
           ,'ᖅᐂ':'-','ᖅᐁ':'ᙯ','ᖃᐃ':'ᙯ','ᕿᐃ':'ᖀ','ᖁᐅ':'ᖂ','ᖃᐊ':'ᖄ','ᕿᐧ':'ᖀ','ᖁᐧ':'ᖂ','ᖃᐧ':'ᖄ'
           ,'ᖕᐁ':'-','ᖓᐃ':'-','ᖏᐃ':'ᖐ','ᖑᐅ':'ᖒ','ᖓᐊ':'ᖔ','ᖏᐧ':'ᖐ','ᖑᐧ':'ᖒ','ᖓᐧ':'ᖔ'
           ,'-ᐃ':'-','ᙳᐅ':'+','ᙳᐊ':'ᙳ','-ᐧ':'-','ᙳᐧ':'+','ᙳᐧ':'ᙳ'
           ,'ᖠᐃ':'ᖡ','ᖢᐅ':'ᖣ','ᖤᐊ':'ᖥ','ᖠᐧ':'ᖡ','ᖢᐧ':'ᖣ','ᖤᐧ':'ᖥ'
        }
       ,submap={
            p:'ᑉ',t:'ᑦ',k:'ᒃ',g:'ᒡ',m:'ᒿ',n:'ᓐ',s:'ᔅ',h:'ᔅ',l:'ᓪ',j:'-',v:'ᕝ',r:'ᕐ',q:'ᖅ','ᓐg':'ᖕ','ᓐn':'ᓐᓐ', 'ᓐᓐg':'ᖖ','+':'ᖦ','ᓪh':'ᖦ', 'x':'ᖦ'
           ,'i':'ᐃ','u':'ᐅ','a':'ᐊ'
           ,'ᑉi':'-','ᑉu':'ᐳ','ᑉa':'ᐿ'
           ,'ᑦi':'ᑎ','ᑦu':'ᑐ','ᑦa':'ᑕ'
           ,'ᒃi':'ᑭ','ᒃu':'ᑯ','ᒃa':'-'
           ,'ᒡi':'ᒋ','ᒡu':'ᒍ','ᒡa':'ᒐ'
           ,'ᒿi':'ᒥ','ᒿu':'ᒧ','ᒿa':'ᒪ'
           ,'ᓐi':'ᓂ','ᓐu':'ᓄ','ᓐa':'ᓇ'
           ,'ᔅi':'ᓯ','ᔅu':'-','ᔅa':'+'
           ,'ᔅi':'ᓯ','ᔅu':'-','ᔅa':'+'
           ,'ᓪi':'ᓕ','ᓪu':'ᓗ','ᓪa':'ᓚ'
           ,'-i':'ᔨ','-u':'ᔪ','-a':'ᔭ'
           ,'ᕝi':'ᕕ','ᕝu':'ᕗ','ᕝa':'ᕙ'
           ,'ᕐi':'ᕆ','ᕐu':'ᕈ','ᕐa':'ᕋ'
           ,'ᖅi':'ᕿ','ᖅu':'ᖁ','ᖅa':'ᖃ'
           ,'ᖕi':'ᖏ','ᖕu':'ᖑ','ᖕa':'ᖓ'
           ,'ᖖi':'-','ᖖu':'ᙳ','ᖖa':'ᙳ'
           ,'ᖦi':'ᖠ','ᖦu':'ᖢ','ᖦa':'ᖤ'

           ,'ᐿ':'ᑉ','ᑕ':'ᑦ','-':'ᒃ','ᒐ':'ᒡ','ᒪ':'ᒿ','ᓇ':'ᓐ','+':'ᔅ','ᓚ':'ᓪ','ᔭ':'-','ᕙ':'ᕝ','ᕋ':'ᕐ','ᖃ':'ᖅ','ᓐᒐ':'ᖕ','ᓐᓇ':'ᓐᓐ', 'ᓐᓐᒐ':'ᖖ','ᖤ':'ᖦ','ᓪ-':'ᖦ'

           ,'ᐿᐃ':'ᐯ','ᑉᐃ':'-','ᑉᐅ':'ᐳ','ᑉᐊ':'ᐿ'
           ,'ᑦᐃ':'ᑎ','ᑦᐅ':'ᑐ','ᑦᐊ':'ᑕ'
           ,'ᒃᐃ':'ᑭ','ᒃᐅ':'ᑯ','ᒃᐊ':'-'
           ,'ᒡᐃ':'ᒋ','ᒡᐅ':'ᒍ','ᒡᐊ':'ᒐ'
           ,'ᒿᐃ':'ᒥ','ᒿᐅ':'ᒧ','ᒿᐊ':'ᒪ'
           ,'ᓐᐃ':'ᓂ','ᓐᐅ':'ᓄ','ᓐᐊ':'ᓇ'
           ,'ᔅᐃ':'ᓯ','ᔅᐅ':'-','ᔅᐊ':'+'
           ,'ᓪᐃ':'ᓕ','ᓪᐅ':'ᓗ','ᓪᐊ':'ᓚ'
           ,'-ᐃ':'ᔨ','-ᐅ':'ᔪ','-ᐊ':'ᔭ'
           ,'ᕝᐃ':'ᕕ','ᕝᐅ':'ᕗ','ᕝᐊ':'ᕙ'
           ,'ᕐᐃ':'ᕆ','ᕐᐅ':'ᕈ','ᕐᐊ':'ᕋ'
           ,'ᖅᐃ':'ᕿ','ᖅᐅ':'ᖁ','ᖅᐊ':'ᖃ'
           ,'ᖕᐃ':'ᖏ','ᖕᐅ':'ᖑ','ᖕᐊ':'ᖓ'
           ,'ᖖᐃ':'-','ᖖᐅ':'ᙳ','ᖖᐊ':'ᙳ'
           ,'ᖦᐃ':'ᖠ','ᖦᐅ':'ᖢ','ᖦᐊ':'ᖤ'
        }

       ,premap={
            '-j':'ᑦ-'
           ,'--':'ᑦ-'
        }

    this.charProcessor = function(chr, buf){
        if (chr=='\u0008') { // backspace
            if (buf.length) {
                return [buf.slice(0,-1),buf.length-1]
            }
        } else if (reNotIKU.test(chr)) {
            return remap[buf+chr] || [buf+chr, 0]
        } else {
            var str=buf+chr
               ,res,cres,h='';

            if (res=remap[str]) {
                return [res,0]
            } else if (res=submap[str]) {
                return [res,res.length]
            } else if(res=premap[str]){
                return [res, 1];
/*      
            } else if (res=submap[buf]) {
                if (cres=remap[chr])
                    return [res+cres,1]
                else
                    return [res+chr,1]
*/      
            } else {
                return [buf + (remap[chr]||submap[chr]||chr), 1]
            }
        }
    }
}
